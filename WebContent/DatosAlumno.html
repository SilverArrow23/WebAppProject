<!DOCTYPE html>
<html lang="es-es">
	<head>
		<title>Informaci&oacute;n alumno</title>
		<meta charset="ISO-8859-1" />
		<script src = "js/jquery.js"></script> 
		<script>
		function onInicio(){
		
			datosAl(asigAl());
				
}	
		function datosAl(){
			$.get("/NOB_Project/DatoAlumnoServlet",function(data){			

				response = $.parseJSON(data);

				$(function() {
					$('#Alumno').append(
						$('<tr>').append(
					            $('<td>').text('Nombre'),					            
					            $('<td>').text('Apellidos'),
					            $('<td>').text('dni')      
					    )		
					);				
				        $('#Alumno').append(			        		
			        		$('<tr id='+data.dni+'>').append(
						            $('<td>').text(response.nombre),
						            $('<td>').text(response.apellidos),
						            $('<td>').text(response.dni)  
						    )
				        );
				});
			});	
				}
		
		function asigAl(){
		$.get("/NOB_Project/listaAsigAlumno",function(data){			
				
				response = $.parseJSON(data);

				console.log("sin parsear" + data);
				
				console.log("ya parseado" + response);
					
				$(function() {
					$('#Asignaturas').append(
						$('<tr>').append(
					            $('<td>').text('Asignatura'),	
					            $('<td>').text('Nota')
					               
					    )		
					);				
				    $.each(response, function(i, item) {
				        $('#Asignaturas').append(			        		
			        		$('<tr id="'+ item.asignatura + '">').append(
						            $('<td>').text(item.asignatura),
						            $('<td>').text(item.nota),
						            $('<td>').append(
                                        $('<button onclick="cambiarNota()" class="btn2 btn-lg btn-primary btn-block" value='+item.asignatura+'name="modificar">Modificar</button>'))
						            
						    )
				        );
				    });
				});
		});
		}
		
		
		function cambiarNota(){
			var mensaje;
	        var nota = prompt("Introduzca la nueva Nota:",);

	        if (nota == null || nota == "" || nota < 0 || nota > 10) {
	                alert("El valor no ha sido introducido o no es válido");
	                }
	        else {
	        	
	        	
	        	$.ajax({
	        	url     : '/NOB_Project/CambiaNotaServlet',
	        	method     : 'GET',
	        	data     : nota,
	        	dataype : 'text',
	        	success    : function() {alert("la nota ha sido modificada a "+nota)}; 
	        	error : function() {alert("Ha ocurrido un error")}; 
	        	});
	        	
			}
	        
	     }
	        

	    
		
		
		$('document').ready(onInicio());
				
	</script>
	</head>
	<body>
	<h1>Datos Personales Alumno</h1>
		<div id="insertar">
			<table id="Alumno"></table>
			<table id="Asignaturas"></table>
		</div>
	</body>
</html>